ga_latest$Date <- as.Date(as.character(ga_latest$Date),'%Y%m%d')
summary_table_cluster$Destination <- gsub('https','http',summary_table_cluster$Destination)
ga_latest$Destination <- gsub('https','http',ga_latest$Destination)
summary_table_cluster$Destination <- gsub('\\/\\?','?',summary_table_cluster$Destination)
ga_latest$Destination <- gsub('\\/\\?','?',ga_latest$Destination)
summary_table_cluster_analytics <- merge(summary_table_cluster,ga_latest,by=c('Date','Destination'),all.x=TRUE)
summary_table_cluster_analytics_names1 <- c('Date','Destination','Channel','Campaign','Cluster','Combined','global_clust_number','cluster_name','votepropensity2017g_buckets.x','sy_vch_index_buckets.x','Age','Religious','Gun Ownership','Educated','Progressive Ideology','catalistmodel_child','married','non_caucasian','Income','is_protestant','Percent Female','Percent Caucasian','catalistmodel_income','Percent Urban','is_coastal','Republican','Persuadable','Democrat','Low Vote Likelihood','Medium Vote Likelihood','High Vote Likelihood','Vote Likelihood Score (Catalist)','Likelihood to Vote Democrat (Catalist)','seg_1','seg_2','seg_3','seg_4','seg_5','seg_6','seg_7','seg_8','seg_9','count','Damage_to_the_Great_Lakes_because_of_pipeline_leaks_could_hurt_Michigans_economy','The_Line_5_pipeline_has_a_serious_impact_on_clean_water','The_Line_5_pipeline_poses_a_direct_risk_to_health_of_Michigan_communities','Alternatives_to_the_Line_5_pipeline_have_their_own_problems_to_consider','Michigan_should_do_more_to_protect_fresh_water_bodies_from_oil_spills_and_other_pollution','The_economic_boost_that_pipelines_create_for__Michigan__is_worth_some_risks_of_potential_pipeline_leaks','The_risks_of_oil_pipeline_leakages_is_too_low_a_probability_to_worry_about_very_much','a_national_effort_to_cut_carbon_dioxide_emissions_by_setting_state_limits_is_a_priority_to_implement','Carbon_taxes_and_CO2_emissions_caps_pose_too_much_risk_to_the_economy','Michigan_should_do_more_to_help_children_and_families_affected_by_lead_poisoning_in_Flint','Investments_in_remedial_education_and_enrichment_programs_are_needed_to_support_children_affected_by_lead_poisoning_in_Flint','Women_have_a_right_to_choose_to_have_an_abortion','Women_should_be_able_to_access_abortions_through_health_insurance_in_the_case_of_rape_or_incest','Abortions_should_not_be_covered_by_health_insurance_in_any_circumstance','Planned_Parenthood_should_not_receive_public_funding','Undocumented_women_under_the_age_of_18_should_be_able_to_access_abortions_legally','Employers_should_have_the_right_to_choose_whether_to_cover_birth_control_as_part_of_their_health_insurance_policies','Medicaid_recipients_should_be_required_to_meet_minimum_work_requirements_before_receiving_benefits','NAFTA_should_be_abolished_or_dramatically_reformed','I_support_stricter_gun_reform_legislation','Michigan_is_facing_an_opioid_crisis','Health_Care_is_unaffordable_in_Michigan_these_days','Auto_insurance_rates_are_too_high_in_Michigan','The_costs_of_a_college_education__have_become_unaffordable_in_Michigan','Closing_skill_gaps_for_the_workforce_in_Michigan_is_a_priority','Michigan_should_raise_the_state_minimum_wage','Politics_in_Michigan_are_corrupt','Legalizing_and_taxing_marijuana_is_a_good_option_for_increasing_state_revenues_and_funding','Legalizing_marijuana_is_a_bad_idea','The_current_policies_of_elected_officials_in_Michigan_are_detrimental_to_the_environment','Ensuring_women_receive_equal_pay_for_their_work_is_a_political_priority','15_per_hour_is_a_fair_and_appropriate_minimum_wage_for_Michigan_workers','PreKindergarten_education_should_be_available_to_all_Michigan_families','Licensing_and_training_teachers_to_use_firearms_is_an_important_option_to_consider_for_mitigating_school_shootings','Police_should_be_able_to_confiscate_firearms_and_ammunition_from_a_person_whom_a_judge_deems_a_legitimate_threat','Charter_schools_are_leaving_Michigan_children_behind','Same_sex_couples_should_be_allowed_to_be_legally_married_in_Michigan','Married_samesex_couples_in_Michigan_should_be_allowed_to_adopt_children','Students_should_be_allowed_to_use_the_restroom_and_locker_room_that_matches_their_gender_identity_whether_or_not_that_is_the_same_as_their_sex_at_birth','Farms_should_have_flexibility_in_the_minimum_wage_they_pay_to_migrant_or_seasonal_workers','Adoption_agencies_should_be_able_to_deny_couples_an_adoption_for_religious_reasons','A_study_by_Michigan_State_U_puts_the_cost_of_cleaning_a_spill_from_the_Line_5_pipeline_at_6_billion','ruptured_or_leakedoil_spilled_could_cover_more_than_17000_square_miles')
summary_table_cluster_analytics_names2 <- c('Enbridge_Line_5_has_spilled_at_least_11M_gallons_in_past_50_years','In_2010_when_the_Line_6B_spilled_into_the_Kalamazoo_River_the_company_didnt_notice_the_pipeline_had_ruptured_until_being_alerted_by_an_outside_caller_17_hours_later','where_children_suffered_brain_damage_due_to_lead_poisoning_from_contaminated_water_sources_dropped_from_418_percent_to_107_percent','Children_in_Flint_exposed_to_contaminated_water_are_at_risk_for_a_number_of_problems_including_lower_IQ_scores_developmental_delays_and_behavioral_issues_Even_after_lead_exposure_stops_the_effects_can_last_for_years_or_even_be_permanent','A_2016_Study_estimated_275_people_in_Michigan_die_each_year_due_to_air_pollution','Michigan_has_high_rates_of_asthma_even_higher_in_Detroit_where_asthma_hospitalization_rate_is_triple_the_state_average','AfricanAmerican_children_in_metro_Detroit_suffered_2402_asthma_attacks_and_missed_1751_school_days_due_to_asthma_per_year','40_of_Michigan_women_live_in_counties_with_no_abortion_clinics','Breast_cancer_is_the_second_leading_cause_of_cancer_death_Each_year_1400_to_1500_Michigan_women_die_of_breast_cancer','1_in_5_women_in_America_has_relied_on_Planned_Parenthood','Bill_Schuette_Republican','Patrick_Colbeck_Republican','Brian_Calley_Republican','Gretchen_Whitmer_Democrat','Abdul_ElSayed_Democrat','Shri_Thanedar_Democrat','Top Issue 1','Top Issue 2','Top Issue 3','x','y','z','Psychographic Segment','Gender','Ethnicity','Coastal','Protestant','Urbanity','Income Level','Age Level','Marital Status','Segment','Matrix Position','votepropensity2017g_buckets.y','sy_vch_index_buckets.y','Budget Allocation','Dollars based on Budget','Coalition','Ad Group','Ad Name','Spend','Reach','Impressions','All Social Engagements','True Engagements','Comments','Shares','Video Views','Video Completions','Link Clicks','Website Clicks','Website Views','Like','Love','Haha','Wow','Sad','Angry','Budget','Theme','Message','Tone','Format','Version','Political','Billing Index','Billing Category','Billing Description','V6','Deep_Views','Duration','Find A Polling Station|Find A Polling Station','Form Submit|Stand Up, Fight Back!','Home_Views','Navigation|Donate','Navigation|Home','Navigation|News',"Navigation|Schuette's Agenda",'Navigation|Take Action',"Navigation|Whitmer's Record",'Navigation|Why We Stand With Whitmer','Navigation|click','Scroll Depth|100','Scroll Depth|25','Scroll Depth|50','Scroll Depth|75','View Content|Find Polling Place','View Content|Radical Agenda','View Content|Whitmer Record','View Content|Why Stand Whitmer','ga:bounces','ga:sessions','ga:users')
summary_table_cluster_analytics_names <- c(summary_table_cluster_analytics_names1,summary_table_cluster_analytics_names2)
setnames(summary_table_cluster_analytics, old=colnames(summary_table_cluster_analytics), new=summary_table_cluster_analytics_names)
packages <- c('shiny','shinydashboard','shinythemes','shinyjs','highcharter','data.table','reshape2','ggplot2','stringr','plotly','scales','readr','dplyr','plyr','rowr','DT','V8')
lapply(packages,library,character.only=TRUE)
#TITLECASE FUNCTION
titlec <- function(x){
s <- strsplit(x, ' ')[[1]]
paste(toupper(substring(s,1,1)),tolower(substring(s, 2)),sep='',collapse=' ')
}
#SET DATES
min_date <- as.Date('2018-04-28')
max_date <- Sys.Date()
dateRangeFull <- seq(min_date,max_date,by='days')
#MAP USERNAMES TO ASSOCIATED ACCESS RIGHTS
username_map <- function(x){
if(grepl('user_lcv',x)){return('LCV')}
else if(grepl('user_pp',x)){return('Planned Parenthood')}
else if(grepl('user_pm',x)){return('Progress Michigan')}
else if(grepl('user_seesaw|wrobinson',x)){return('all_groups')}
}
default_user <- 'user_seesaw'
interest_groups <- c('LCV','Progress Michigan','Planned Parenthood')
h <- c('Summary View','Creative Detail','Post Reactions','Sentiment','Social Listening','Glossary')
channels <- c('Facebook','Twitter','Google')
active_topics <- c('Education','Betsy DeVos','Healthcare','Legalization of Marijuana','Unemployment','Infrastructure','Environment','Civil Rights & Equality','Abortion & Birth Control','Seniors Issues','Second Amendment Rights','Gun Crime')
active_topics_lcv <- c('Environment')
active_topics_pp <- c('Abortion & Birth Control')
active_topics_pm <- c('Education','Betsy DeVos','Healthcare','Legalization of Marijuana','Unemployment','Infrastructure','Civil Rights & Equality','Seniors Issues','Second Amendment Rights','Gun Crime')
chart_dims <- c('Gender','Ethnicity','Matrix Position','Psychographic Segment','Message','Date','Age','Coastal','Protestant','Urban','Income','Married')
chart_metrics <- c('Spend','Engagements','Shares','Impressions','Engagement Rate','CPM','Cost / Engagement','Cost / Share')
#READ IN DATA
mypath = '/Users/harveymanhood/Documents/- github/seesaw-dashboard/flamingo/'
facebook_new <- fread(paste0(mypath,'data/facebook.csv'))
reach_day <- fread(paste0(mypath,'data/reach.csv'))
twitter_new <- fread(paste0(mypath,'data/twitter.csv'))
google <- fread(paste0(mypath,'data/google.csv'))
sentiment <- fread(paste0(mypath,'data/sentiment/daily_sentiment.csv'))
sentiment_lookup <- fread(paste0(mypath,'data/sentiment/daily_sentiment_lookup.csv'))
messages <- fread(paste0(mypath,'data/messages.csv'))
tone <- fread(paste0(mypath,'data/tone.csv'))
theme <- fread(paste0(mypath,'data/theme.csv'))
news <- fread(paste0(mypath,'data/daily_news.csv'))
hashtags <- fread(paste0(mypath,'data/daily_hashtags.csv'))
hashtags_lookup <- fread(paste0(mypath,'data/daily_hashtags_lookup.csv'))
competitor_display <- fread(paste0(mypath,'data/competitor_display.csv'))
clusters <- fread(paste0(mypath,'data/global_cluster_centroid.csv'),data.table=F)
cluster_key <- fread(paste0(mypath,'data/cluster_key.csv'))
cluster_list <- fread(paste0(mypath,'data/cluster_quadrant_list.csv'))
survey <- fread(paste0(mypath,'data/survey.csv'))
survey_test <- fread(paste0(mypath,'data/survey_test.csv'))
billing <- fread(paste0(mypath,'data/billing_groups.csv'))
billing_lookup <- fread(paste0(mypath,'data/billing_lookup.csv'))
invoices <- fread(paste0(mypath,'data/invoices.csv'))
#READ IN NEW DATA VERSIONS
facebook_latest <- fread('/Users/harveymanhood/Documents/- tools/- python/- facebook ads api/facebook_new.csv')
twitter_latest <- fread('/Users/harveymanhood/Documents/- tools/- python/- twitter api/twitter_new.csv')
google_latest <- fread('/Users/harveymanhood/Documents/- tools/- python/- adwords api/google_new.csv')
ga_latest <- fread('/Users/harveymanhood/Documents/- tools/- python/- google analytics api/analytics_new.csv')
news <- news[order(news$Date,decreasing=TRUE),]
hashtags <- merge(hashtags,hashtags_lookup,all.x=TRUE)
news$Category <- gsub(' Election',' Race',news$Category)
categories_news <- sort(unique(news$Category))
categories_social <- sort(unique(hashtags$Category))
competitor_display$TextDate <- format(as.Date(competitor_display$`Date Created`), format='%B %d, %Y')
categorydisplay <- unique(competitor_display$Name)
formats <- data.frame(c('30','15','6','image','carousel','survey'),c('Video: 30 seconds','Video: 15 seconds','Video: 6 seconds','Image','Carousel','Sentiment Survey'))
colnames(formats) <- c('old','new')
#----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#  CLUSTER DATA PREPARATION
#----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
clusters$x <- round(clusters$catalistmodel_vch_index, 2)
clusters$y <- round(clusters$catalistmodel_voteprop2018, 2)
clusters$z <- clusters$count
clusters$age <- round(clusters$age, 2)
clusters <- dplyr::rename(
clusters,
Age = age,
Income = income_num,
`Percent Caucasian` = is_caucasian,
`Percent Female` = is_female,
`Percent Urban` = is_urban,
`Gun Ownership` = catalistmodel_gun_owner,
`Progressive Ideology` = catalistmodel_ideology,
`Educated` = catalistmodel_education,
`Religious` = catalistmodel_religious_attendance_bin
) %>%
arrange(global_clust_number)
cluster_dims <- c('Age','Income','Percent Caucasian','Percent Female','Percent Urban')
cluster_cats <- c('Segment','Educated','Progressive Ideology','Religious','Gun Ownership')
quadrant <- c('Unspecified (Phase 1)',unique(cluster_list$Quadrant))
segment_names <- c(
'Super Secular',
'Traditional Democrats',
'Paycheck to Paycheck Progressives',
'Libertarian Left',
'New Suburbans',
'Nostalgic Traditionalists',
'Merit and Markets',
'Identity Conservatives',
'Fox Loyalists'
)
clusters$`Psychographic Segment` <- segment_names[max.col(clusters[,grepl('seg_',names(clusters))])]
clusters$Cluster <- as.character(clusters$global_clust_number)
clusters$Combined <- paste(clusters$votepropensity2017g_buckets,clusters$sy_vch_index_buckets,sep='')
clusters$Gender <- cut(as.numeric(clusters$`Percent Female`), breaks = c(-Inf, 0.5, Inf),labels = c('Male','Female'))
clusters$Ethnicity <- cut(as.numeric(clusters$`Percent Caucasian`), breaks = c(-Inf, 0.5, Inf),labels = c('Caucasian','Non-Caucasian'))
clusters$Bi_Coastal <- cut(as.numeric(clusters$is_coastal), breaks = c(-Inf, 0.5, Inf),labels = c('Coastal','Non_Costal'))
clusters$Bi_Protestant <- cut(as.numeric(clusters$is_protestant), breaks = c(-Inf, 0.5, Inf),labels = c('Protestant','Non_Protestant'))
clusters$Bi_Urban <- cut(as.numeric(clusters$`Percent Urban`), breaks = c(-Inf, 0.6, Inf),labels = c('Rural','Urban'))
clusters$IncomeLvl <- cut(as.numeric(clusters$Income), breaks = c(0, 30, 69,Inf),labels = c('Low Income','Middle Class','Upper Class'))
clusters$AgeLvl <- cut(as.numeric(clusters$Age), breaks = c(0, 36, 57,Inf),labels = c('Young','Middle Aged','Older'))
clusters$Bi_Married <- cut(as.numeric(clusters$married), breaks = c(-Inf, 0.6, Inf),labels = c('Not Married','Married'))
clusters$Segment <- segment_names[max.col(clusters[,grepl('seg_',names(clusters))])]
clusters$Cluster <- as.character(clusters$global_clust_number)
clusters$Combined <- paste(clusters$votepropensity2017g_buckets,clusters$sy_vch_index_buckets,sep='')
catalist_clusters <- merge(clusters,cluster_key,by='Combined')
#----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#  FACEBOOK
#----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
facebook_colnames <- c('account_id','ad_id','Ad name','adset_id','Ad set name','campaign_id','Campaign name','Date','date_stop','Impressions','inline_link_clicks','inline_post_engagement','Reach','relevance_score','Amount spent','unique_clicks','Comments','actions_like','actions_photo_view','Shares','Link Clicks','Website Clicks','Post engagements','actions_page_engagement','actions_post_reaction','Video Views','actions_video_avg_percent_watched_actions','video_avg_percent_watched_actions_28d_click','actions_video_avg_time_watched_actions','video_avg_time_watched_actions_28d_click','Video Completions','video_p100_watched_actions_28d_click','actions_video_p25_watched_actions','video_p25_watched_actions_28d_click','actions_video_p50_watched_actions','video_p50_watched_actions_28d_click','actions_video_p75_watched_actions','video_p75_watched_actions_28d_click','actions_video_p95_watched_actions','video_p95_watched_actions_28d_click','Like','Love','Haha','Wow','Sad','Angry','configured_status','creative_id','name','instagram_actor_id','page_id','link_name2','video_id','creative_image_hash','creative_message','External destination URL','creative_title','creative_link_description','creative_cta_type')
setnames(facebook_new, old=colnames(facebook_new), new=facebook_colnames)
facebook_summary_colnames <- c('Date','Campaign name','Ad set name','Ad name','External destination URL','Amount spent','Reach','Impressions','Post engagements','Comments','Shares','Video Views','Video Completions','Link Clicks','Website Clicks','Like','Love','Haha','Wow','Sad','Angry')
facebook_summary <- facebook_new[,facebook_summary_colnames,with=FALSE]
#MUNGING NEW VERSION
facebook_latest_colnames <- c('account_id','ad_id','Ad name','adset_id','Ad set name','campaign_id','Campaign name','Date','date_stop','Impressions','inline_link_clicks','inline_post_engagement','Reach','relevance_score','Amount spent','unique_clicks','Comments','actions_like','actions_photo_view','Shares','Link Clicks','Website Clicks','Post engagements','actions_page_engagement','actions_post_reaction','Video Views','Website Views','actions_video_avg_percent_watched_actions','video_avg_percent_watched_actions_28d_click','actions_video_avg_time_watched_actions','video_avg_time_watched_actions_28d_click','Video Completions','video_p100_watched_actions_28d_click','actions_video_p25_watched_actions','video_p25_watched_actions_28d_click','actions_video_p50_watched_actions','video_p50_watched_actions_28d_click','actions_video_p75_watched_actions','video_p75_watched_actions_28d_click','actions_video_p95_watched_actions','video_p95_watched_actions_28d_click','Like','Love','Haha','Wow','Sad','Angry','creative_id','Ad Bid Amount','bid_info','configured_status','created_time','effective_status','creative_name','instagram_actor_id','page_id','link_name2','video_id','creative_image_hash','creative_message','External destination URL','creative_title','creative_link_description','creative_cta_type','adset_billing_event','adset_budget_remaining','adset_configured_status','campaign_buying_type','campaign_configured_status','campaign_effective_status','campaign_objective','Campaign Spend Cap','campaign_start_time','campaign_stop_time','campaign_updated_time')
setnames(facebook_latest, old=colnames(facebook_latest), new=facebook_latest_colnames)
facebook_summary_latest_colnames <- c('Date','Campaign name','Ad set name','Ad name','External destination URL','Amount spent','Reach','Impressions','Post engagements','Comments','Shares','Video Views','Video Completions','Link Clicks','Website Clicks','Website Views','Like','Love','Haha','Wow','Sad','Angry','Campaign Spend Cap')
facebook_summary <- facebook_latest[,facebook_summary_latest_colnames,with=FALSE]
facebook_summary$Coalition <- ifelse(grepl('LCV',facebook_summary$`Campaign name`),'LCV',ifelse(grepl('Planned|Protect',facebook_summary$`Campaign name`),'Planned Parenthood',ifelse(grepl('Progress',facebook_summary$`Campaign name`),'Progress Michigan','OTHER')))
facebook_summary$Channel <- 'Facebook'
facebook_summary$Date <- as.Date(facebook_summary$Date,'%Y-%m-%d')
facebook_summary$`True Engagements` <- rowSums(facebook_summary[,c('Like','Love','Haha','Wow','Sad','Angry','Shares')],na.rm=TRUE)
facebook_summary <- facebook_summary[,c('Date','Channel','Coalition','Campaign name','Ad set name','Ad name','External destination URL','Amount spent','Reach','Impressions','Post engagements','True Engagements','Comments','Shares','Video Views','Video Completions','Link Clicks','Website Clicks','Website Views','Like','Love','Haha','Wow','Sad','Angry','Campaign Spend Cap')]
#PHASE 1 - OUR CAMPAIGNS & NAMING STRUCTURE UP UNTIL 31 MAY
facebook_summary_phase1a <- facebook_summary[(grepl('V2',facebook_summary$`Ad name`) & Date < as.Date('2018-06-01','%Y-%m-%d')),]
facebook_summary_phase1b <- facebook_summary[(!grepl('V2',facebook_summary$`Ad name`) & Date < as.Date('2018-06-01','%Y-%m-%d')),]
facebook_summary_phase1a$`Ad name` <- paste0(gsub('_V2','',facebook_summary_phase1a$`Ad name`),'_V2')
facebook_summary_phase1 <- bind_rows(facebook_summary_phase1a,facebook_summary_phase1b)
facebook_summary_phase1 <- facebook_summary_phase1[,c('Theme','Message','Tone','Format','Version') := tstrsplit(`Ad name`, '_')]
facebook_summary_phase1 <- facebook_summary_phase1[,c('Political Ad Id') := titlec(str_sub(str_extract(facebook_summary_phase1$`Campaign name`,'\\| [A-Za-z0-9\\-_]+$'),3,-1))]
facebook_summary_phase1$Cluster <- ''
#PHASE 2 - OUR CAMPAIGNS & NAMING STRUCTURE FROM AUGUST, WITH CLUSTER DATA
facebook_summary_phase2 <- facebook_summary[Date >= as.Date('2018-06-01','%Y-%m-%d'),]
facebook_summary_phase2$`Ad name` <- gsub(' - v2','',facebook_summary_phase2$`Ad name`)
facebook_summary_phase2[,c('Theme','Message','Tone','Format','Version','Political Ad Id')] <- '-'
facebook_summary_phase2$Message <- unlist(lapply(facebook_summary_phase2$`Ad name`,function(x) paste(strsplit(x, '_')[[1]][2],strsplit(x, '_')[[1]][3])))
facebook_summary_phase2$Theme <- facebook_summary_phase2$Message
facebook_summary_phase2$Format <- unlist(lapply(facebook_summary_phase2$`Ad name`,function(x) strsplit(x, '_')[[1]][4]))
facebook_summary_phase2$Cluster <- facebook_summary_phase2$`Ad set name` #duplication here for futureproofing and clarity
facebook_summary_phase2$Message <- ifelse(grepl('survey',facebook_summary_phase2$`Ad name`),'Sentiment Survey',facebook_summary_phase2$Message)
facebook_summary_phase2$Format <- ifelse(grepl('survey',facebook_summary_phase2$`Ad name`),'survey',facebook_summary_phase2$Format)
#COMBINE SUBTABLES
facebook_summary <- bind_rows(facebook_summary_phase1,facebook_summary_phase2)
#MESSAGE LOOKUP
facebook_summary$Message <- messages$MessageNew[match(unlist(facebook_summary$Message), messages$Message)]
facebook_summary$Tone <- tone$ToneNew[match(unlist(facebook_summary$Tone), tone$Tone)]
facebook_summary$Theme <- theme$ThemeNew[match(unlist(facebook_summary$Theme), theme$Theme)]
#facebook_summary$Format <- gsub(' - Copy','',facebook_summary$Format)
facebook_summary$Format <- formats$new[match(unlist(gsub(' - Copy','',facebook_summary$Format)), formats$old)]
facebook_summary$`Campaign Spend Cap` <- as.numeric(facebook_summary$`Campaign Spend Cap`)
#SUBSET WITH NO REACTION DATA
facebook_summary2 <- facebook_summary[,c(1:16,23:29)] #remove reactions from this version
#REACH CALCULATIONS
reach_day$Start <- as.Date(reach_day$Start,'%Y-%m-%d')
reach_day$End <- as.Date(reach_day$End,'%Y-%m-%d')
#MERGE FACEBOOK TABLE WITH REACTIONS TO GET FULL REACTIONS TABLE
reactions_table1 <- facebook_summary
reactions_table1[,c('Like','Love','Haha','Wow','Sad','Angry')][is.na(reactions_table1[,c('Like','Love','Haha','Wow','Sad','Angry')])] <- 0
#----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#  TWITTER   'replies','retweets','video_3s100pct_views','video_views_100','url_clicks'
#----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
twitter_colnames <- c('tweet_approval_status','tweet_created_at','tweet_deleted','tweet_entity_status','tweet_id','adgroup_id','status_id','tweet_updated_at','account_id','adgroup_advertiser_domain','adgroup_advertiser_user_id','adgroup_automatically_select_bid','adgroup_bid_amount_local_micro','adgroup_bid_type','adgroup_bid_unit','campaign_id','adgroup_categories','adgroup_charge_by','adgroup_created_at','adgroup_creative_source','adgroup_currency','adgroup_deleted','adgroup_end_time','adgroup_entity_status','adgroup_include_sentiment','adgroup_name','adgroup_objective','adgroup_optimization','adgroup_placements','adgroup_primary_web_event_tag','adgroup_product_type','adgroup_start_time','adgroup_target_cpa_local_micro','adgroup_total_budget_amount_local_micro','adgroup_tracking_tags','adgroup_updated_at','card_uri','status_text','status_link','card_type','card_content_duration_seconds','card_created_at','card_deleted','card_id','card_image','card_image_display_height','card_image_display_width','card_name','card_preview_url','card_title','card_updated_at','card_video_content_id','card_video_height','card_video_hls_url','card_video_owner_id','card_video_poster_height','card_video_poster_url','card_video_poster_width','card_video_url','card_video_width','card_website_dest_url','card_website_display_url','card_website_shortened_url','card_website_title','card_website_url','website_url','campaign_created_at','campaign_currency','campaign_daily_budget_amount_local_micro','campaign_deleted','campaign_duration_in_days','campaign_end_time','campaign_entity_status','campaign_frequency_cap','campaign_funding_instrument_id','campaign_name','campaign_reasons_not_servable','campaign_servable','campaign_standard_delivery','campaign_start_time','campaign_total_budget_amount_local_micro','campaign_updated_at','account_approval_status','account_business_id','account_business_name','account_created_at','account_deleted','account_industry_type','account_name','account_salt','account_timezone','account_timezone_switch_at','account_updated_at','app_clicks','auto_created_conversion_add_to_cart','auto_created_conversion_add_to_wish_list','auto_created_conversion_added_payment_info','auto_created_conversion_checkout_initiated','auto_created_conversion_complete_registration','auto_created_conversion_content_view','auto_created_conversion_download','auto_created_conversion_page_view','auto_created_conversion_purchase','auto_created_conversion_search','auto_created_conversion_sign_up_initiated','billed_charge_local_micro','billed_engagements','card_engagements','carousel_swipes','clicks','conversion_custom','conversion_downloads','conversion_purchases','conversion_sign_ups','conversion_site_visits','engagements','follows','impressions','likes','media_engagements','media_views','poll_card_vote','qualified_impressions','replies','retweets','tweets_send','unfollows','url_clicks','video_3s100pct_views','video_content_starts','video_cta_clicks','video_mrc_views','video_total_views','video_views_100','video_views_25','video_views_50','video_views_75','date')
twitter_new <- twitter_latest
twitter_colnames <- c('tweet_approval_status','tweet_created_at','tweet_deleted','tweet_entity_status','tweet_id','adgroup_id','status_id','tweet_updated_at','card_uri','status_text','status_link','card_type','card_content_duration_seconds','card_created_at','card_deleted','card_id','card_image','card_name','card_preview_url','card_title','card_updated_at','card_video_content_id','card_video_height','card_video_hls_url','card_video_owner_id','card_video_poster_height','card_video_poster_url','card_video_poster_width','card_video_url','card_video_width','card_website_dest_url','card_website_display_url','card_website_shortened_url','card_website_title','card_website_url','website_url','adgroup_advertiser_domain','adgroup_advertiser_user_id','adgroup_automatically_select_bid','adgroup_bid_amount_local_micro','adgroup_bid_type','adgroup_bid_unit','campaign_id','adgroup_categories','adgroup_charge_by','adgroup_created_at','adgroup_creative_source','adgroup_currency','adgroup_deleted','adgroup_end_time','adgroup_entity_status','adgroup_include_sentiment','adgroup_name','adgroup_objective','adgroup_optimization','adgroup_placements','adgroup_primary_web_event_tag','adgroup_product_type','adgroup_start_time','adgroup_target_cpa_local_micro','adgroup_total_budget_amount_local_micro','adgroup_tracking_tags','adgroup_updated_at','account_id','campaign_created_at','campaign_currency','campaign_daily_budget_amount_local_micro','campaign_deleted','campaign_duration_in_days','campaign_end_time','campaign_entity_status','campaign_frequency_cap','campaign_funding_instrument_id','campaign_name','campaign_reasons_not_servable','campaign_servable','campaign_standard_delivery','campaign_start_time','campaign_total_budget_amount_local_micro','campaign_updated_at','account_approval_status','account_business_id','account_business_name','account_created_at','account_deleted','account_industry_type','account_name','account_salt','account_timezone','account_timezone_switch_at','account_updated_at','app_clicks','auto_created_conversion_add_to_cart','auto_created_conversion_add_to_wish_list','auto_created_conversion_added_payment_info','auto_created_conversion_checkout_initiated','auto_created_conversion_complete_registration','auto_created_conversion_content_view','auto_created_conversion_download','auto_created_conversion_page_view','auto_created_conversion_purchase','auto_created_conversion_search','auto_created_conversion_sign_up_initiated','billed_charge_local_micro','billed_engagements','card_engagements','carousel_swipes','clicks','conversion_custom','conversion_downloads','conversion_purchases','conversion_sign_ups','conversion_site_visits','engagements','follows','impressions','likes','media_engagements','media_views','poll_card_vote','qualified_impressions','replies','retweets','tweets_send','unfollows','url_clicks','video_3s100pct_views','video_content_starts','video_cta_clicks','video_mrc_views','video_total_views','video_views_100','video_views_25','video_views_50','video_views_75','date')
twitter_new$Coalition <- ifelse(grepl('LCV',twitter_new$account_name),'LCV',ifelse(grepl('Planned',twitter_new$account_name),'Planned Parenthood',ifelse(grepl('Progress',twitter_new$account_name),'Progress Michigan','OTHER')))
twitter_new[is.na(twitter_new)] <- 0
twitter_new$Channel <- 'Twitter'
twitter_new$Reach <- 0
twitter_new$Spend <- as.numeric(twitter_new$billed_charge_local_micro)/1000000 #convert twitter micro-dollars back to dollars and cents
twitter_new[,c('Theme','Message','Tone','Format','Version','Political Ad Id')] <- '-'
twitter_new$Engagements <- as.numeric(twitter_new$engagements) + as.numeric(twitter_new$video_3s100pct_views) #this is video views
twitter_new$`True Engagements` <- rowSums(twitter_new[,c('likes','retweets')],na.rm=TRUE)
twitter_new$impressions <- as.numeric(twitter_new$impressions)
twitter_new$replies <- as.numeric(twitter_new$replies)
twitter_new$retweets <- as.numeric(twitter_new$retweets)
twitter_new$video_3s100pct_views <- as.numeric(twitter_new$video_3s100pct_views)
twitter_new$video_views_100 <- as.numeric(twitter_new$video_views_100)
twitter_new$video_content_starts <- as.numeric(twitter_new$video_content_starts)
twitter_new$video_total_views <- as.numeric(twitter_new$video_total_views)
twitter_new$url_clicks <- as.numeric(twitter_new$url_clicks)
twitter_new$date <- as.Date(twitter_new$date,'%Y-%m-%d')
twitter_new[,c('Love','Haha','Wow','Sad','Angry','Website Views')] <- 0
twitter_summary <- twitter_new[,c('date','Channel','Coalition','campaign_name','adgroup_name','status_text','card_website_dest_url','Spend','Reach','impressions','Engagements','True Engagements','replies','retweets','video_3s100pct_views','video_views_100','clicks','url_clicks','Website Views','likes','Love','Haha','Wow','Sad','Angry','campaign_total_budget_amount_local_micro','Theme','Message','Tone','Format','Version','Political Ad Id')]
twitter_summary$Cluster <- ''
twitter_summary$`campaign_total_budget_amount_local_micro` <- as.numeric(twitter_summary$`campaign_total_budget_amount_local_micro`)
#----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#  GOOGLE   '-','-','-','Video played to 100%','Clicks'
#----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
google <- google_latest[google_latest$Impressions > 0,]
google$Coalition <- ifelse(grepl('LCV',google$Campaign),'LCV',ifelse(grepl('PP|Planned|Protect',google$Campaign),'Planned Parenthood',ifelse(grepl('PM|Progress',google$Campaign),'Progress Michigan','OTHER')))
google$Channel <- 'Google'
google$Day <- as.Date(google$Day,'%Y-%m-%d')
google$Reach <- 0
google[,c('Theme','Message','Tone','Format','Version','Political')] <- ''
google[,c('Like','Love','Haha','Wow','Sad','Angry','Link Clicks')] <- 0
google$Comments <- 0.0
google$Shares <- 0
google$`Website Clicks` <- 0
google$`Website Views` <- 0
google$`Video Views` <- google$Impressions
google$Clicks <- as.numeric(google$Clicks)
google$Cost <- as.numeric(google$Cost)
google$`True Engagements` <- rowSums(google[,c('Clicks')],na.rm=TRUE)
google_summary <- google[,c('Day','Channel','Coalition','Campaign','Ad group','Ad','Ad final URL','Cost','Reach','Impressions','Clicks','True Engagements','Comments','Shares','Video Views','Video played to 100%','Link Clicks','Website Clicks','Website Views','Like','Love','Haha','Wow','Sad','Angry','Budget','Theme','Message','Tone','Format','Version','Political')]
google_summary$Cluster <- ''
google_summary$Budget <- as.numeric(google_summary$Budget)
google_summary$Impressions <- as.numeric(google_summary$Impressions)
#----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#  COMBINE CHANNELS
#----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
standard_names <- c('Date','Channel','Coalition','Campaign','Ad Group','Ad Name','Destination','Spend','Reach','Impressions','Engagements','True Engagements','Comments','Shares','Video Views','Video Completions','Link Clicks','Website Clicks','Website Views','Like','Love','Haha','Wow','Sad','Angry','Budget','Theme','Message','Tone','Format','Version','Political','Cluster')
setnames(facebook_summary, old=colnames(facebook_summary), new=standard_names)
setnames(twitter_summary, old=colnames(twitter_summary), new=standard_names)
setnames(google_summary, old=colnames(google_summary), new=standard_names)
summary_table <- bind_rows(facebook_summary,twitter_summary,google_summary)
for (i in names(summary_table)){summary_table[is.na(get(i)),(i):=0]}
#----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#  BRING IN CLUSTER DATA
#----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
summary_table_cluster <- setDT(merge(x = catalist_clusters, y = summary_table, by = 'Cluster', all.y = TRUE))
summary_table_cluster$`Matrix Position` <- cluster_list$Quadrant[match(unlist(summary_table_cluster$`Matrix Position`), cluster_list$`Matrix Position`)]
summary_table_cluster$`Matrix Position`[is.na(summary_table_cluster$`Matrix Position`)] <- 'Unspecified (Phase 1)'
summary_table_cluster <- merge(summary_table_cluster,billing,on='Campaign',all.x=TRUE)
yaxistest <- aggregate(cbind(Spend,Engagements, Impressions) ~ Date + Gender + Ethnicity+Bi_Urban+Bi_Coastal+Bi_Protestant+`Matrix Position`+`Psychographic Segment`+Message,data=summary_table_cluster, sum, na.rm = TRUE)
#----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#  BRING IN GOOGLE ANALYTICS DATA
#----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
ga_latest_colnames <- c('Date','Destination','Deep_Views','Duration','Find A Polling Station|Find A Polling Station','Form Submit|Stand Up, Fight Back!','Home_Views','Navigation|Donate','Navigation|Home','Navigation|News',"Navigation|Schuette's Agenda",'Navigation|Take Action',"Navigation|Whitmer's Record",'Navigation|Why We Stand With Whitmer','Navigation|click','Scroll Depth|100','Scroll Depth|25','Scroll Depth|50','Scroll Depth|75','View Content|Find Polling Place','View Content|Radical Agenda','View Content|Whitmer Record','View Content|Why Stand Whitmer','ga:bounces','ga:sessions','ga:users')
setnames(ga_latest, old=colnames(ga_latest), new=ga_latest_colnames)
ga_latest$Date <- as.Date(as.character(ga_latest$Date),'%Y%m%d')
summary_table_cluster$Destination <- gsub('https','http',summary_table_cluster$Destination)
ga_latest$Destination <- gsub('https','http',ga_latest$Destination)
summary_table_cluster$Destination <- gsub('\\/\\?','?',summary_table_cluster$Destination)
ga_latest$Destination <- gsub('\\/\\?','?',ga_latest$Destination)
summary_table_cluster_analytics <- merge(summary_table_cluster,ga_latest,by=c('Date','Destination'),all.x=TRUE)
summary_table_cluster_analytics_names1 <- c('Date','Destination','Channel','Campaign','Cluster','Combined','global_clust_number','cluster_name','votepropensity2017g_buckets.x','sy_vch_index_buckets.x','Age','Religious','Gun Ownership','Educated','Progressive Ideology','catalistmodel_child','married','non_caucasian','Income','is_protestant','Percent Female','Percent Caucasian','catalistmodel_income','Percent Urban','is_coastal','Republican','Persuadable','Democrat','Low Vote Likelihood','Medium Vote Likelihood','High Vote Likelihood','Vote Likelihood Score (Catalist)','Likelihood to Vote Democrat (Catalist)','seg_1','seg_2','seg_3','seg_4','seg_5','seg_6','seg_7','seg_8','seg_9','count','Damage_to_the_Great_Lakes_because_of_pipeline_leaks_could_hurt_Michigans_economy','The_Line_5_pipeline_has_a_serious_impact_on_clean_water','The_Line_5_pipeline_poses_a_direct_risk_to_health_of_Michigan_communities','Alternatives_to_the_Line_5_pipeline_have_their_own_problems_to_consider','Michigan_should_do_more_to_protect_fresh_water_bodies_from_oil_spills_and_other_pollution','The_economic_boost_that_pipelines_create_for__Michigan__is_worth_some_risks_of_potential_pipeline_leaks','The_risks_of_oil_pipeline_leakages_is_too_low_a_probability_to_worry_about_very_much','a_national_effort_to_cut_carbon_dioxide_emissions_by_setting_state_limits_is_a_priority_to_implement','Carbon_taxes_and_CO2_emissions_caps_pose_too_much_risk_to_the_economy','Michigan_should_do_more_to_help_children_and_families_affected_by_lead_poisoning_in_Flint','Investments_in_remedial_education_and_enrichment_programs_are_needed_to_support_children_affected_by_lead_poisoning_in_Flint','Women_have_a_right_to_choose_to_have_an_abortion','Women_should_be_able_to_access_abortions_through_health_insurance_in_the_case_of_rape_or_incest','Abortions_should_not_be_covered_by_health_insurance_in_any_circumstance','Planned_Parenthood_should_not_receive_public_funding','Undocumented_women_under_the_age_of_18_should_be_able_to_access_abortions_legally','Employers_should_have_the_right_to_choose_whether_to_cover_birth_control_as_part_of_their_health_insurance_policies','Medicaid_recipients_should_be_required_to_meet_minimum_work_requirements_before_receiving_benefits','NAFTA_should_be_abolished_or_dramatically_reformed','I_support_stricter_gun_reform_legislation','Michigan_is_facing_an_opioid_crisis','Health_Care_is_unaffordable_in_Michigan_these_days','Auto_insurance_rates_are_too_high_in_Michigan','The_costs_of_a_college_education__have_become_unaffordable_in_Michigan','Closing_skill_gaps_for_the_workforce_in_Michigan_is_a_priority','Michigan_should_raise_the_state_minimum_wage','Politics_in_Michigan_are_corrupt','Legalizing_and_taxing_marijuana_is_a_good_option_for_increasing_state_revenues_and_funding','Legalizing_marijuana_is_a_bad_idea','The_current_policies_of_elected_officials_in_Michigan_are_detrimental_to_the_environment','Ensuring_women_receive_equal_pay_for_their_work_is_a_political_priority','15_per_hour_is_a_fair_and_appropriate_minimum_wage_for_Michigan_workers','PreKindergarten_education_should_be_available_to_all_Michigan_families','Licensing_and_training_teachers_to_use_firearms_is_an_important_option_to_consider_for_mitigating_school_shootings','Police_should_be_able_to_confiscate_firearms_and_ammunition_from_a_person_whom_a_judge_deems_a_legitimate_threat','Charter_schools_are_leaving_Michigan_children_behind','Same_sex_couples_should_be_allowed_to_be_legally_married_in_Michigan','Married_samesex_couples_in_Michigan_should_be_allowed_to_adopt_children','Students_should_be_allowed_to_use_the_restroom_and_locker_room_that_matches_their_gender_identity_whether_or_not_that_is_the_same_as_their_sex_at_birth','Farms_should_have_flexibility_in_the_minimum_wage_they_pay_to_migrant_or_seasonal_workers','Adoption_agencies_should_be_able_to_deny_couples_an_adoption_for_religious_reasons','A_study_by_Michigan_State_U_puts_the_cost_of_cleaning_a_spill_from_the_Line_5_pipeline_at_6_billion','ruptured_or_leakedoil_spilled_could_cover_more_than_17000_square_miles')
summary_table_cluster_analytics_names2 <- c('Enbridge_Line_5_has_spilled_at_least_11M_gallons_in_past_50_years','In_2010_when_the_Line_6B_spilled_into_the_Kalamazoo_River_the_company_didnt_notice_the_pipeline_had_ruptured_until_being_alerted_by_an_outside_caller_17_hours_later','where_children_suffered_brain_damage_due_to_lead_poisoning_from_contaminated_water_sources_dropped_from_418_percent_to_107_percent','Children_in_Flint_exposed_to_contaminated_water_are_at_risk_for_a_number_of_problems_including_lower_IQ_scores_developmental_delays_and_behavioral_issues_Even_after_lead_exposure_stops_the_effects_can_last_for_years_or_even_be_permanent','A_2016_Study_estimated_275_people_in_Michigan_die_each_year_due_to_air_pollution','Michigan_has_high_rates_of_asthma_even_higher_in_Detroit_where_asthma_hospitalization_rate_is_triple_the_state_average','AfricanAmerican_children_in_metro_Detroit_suffered_2402_asthma_attacks_and_missed_1751_school_days_due_to_asthma_per_year','40_of_Michigan_women_live_in_counties_with_no_abortion_clinics','Breast_cancer_is_the_second_leading_cause_of_cancer_death_Each_year_1400_to_1500_Michigan_women_die_of_breast_cancer','1_in_5_women_in_America_has_relied_on_Planned_Parenthood','Bill_Schuette_Republican','Patrick_Colbeck_Republican','Brian_Calley_Republican','Gretchen_Whitmer_Democrat','Abdul_ElSayed_Democrat','Shri_Thanedar_Democrat','Top Issue 1','Top Issue 2','Top Issue 3','x','y','z','Psychographic Segment','Gender','Ethnicity','Coastal','Protestant','Urbanity','Income Level','Age Level','Marital Status','Segment','Matrix Position','votepropensity2017g_buckets.y','sy_vch_index_buckets.y','Budget Allocation','Dollars based on Budget','Coalition','Ad Group','Ad Name','Spend','Reach','Impressions','All Social Engagements','True Engagements','Comments','Shares','Video Views','Video Completions','Link Clicks','Website Clicks','Website Views','Like','Love','Haha','Wow','Sad','Angry','Budget','Theme','Message','Tone','Format','Version','Political','Billing Index','Billing Category','Billing Description','Deep_Views','Duration','Find A Polling Station|Find A Polling Station','Form Submit|Stand Up, Fight Back!','Home_Views','Navigation|Donate','Navigation|Home','Navigation|News',"Navigation|Schuette's Agenda",'Navigation|Take Action',"Navigation|Whitmer's Record",'Navigation|Why We Stand With Whitmer','Navigation|click','Scroll Depth|100','Scroll Depth|25','Scroll Depth|50','Scroll Depth|75','View Content|Find Polling Place','View Content|Radical Agenda','View Content|Whitmer Record','View Content|Why Stand Whitmer','ga:bounces','ga:sessions','ga:users')
summary_table_cluster_analytics_names <- c(summary_table_cluster_analytics_names1,summary_table_cluster_analytics_names2)
setnames(summary_table_cluster_analytics, old=colnames(summary_table_cluster_analytics), new=summary_table_cluster_analytics_names)
summary_table_cluster_analytics
summary_table_cluster
unique(summary_table_cluster_analtyics$Campaign)
unique(summary_table_cluster_analytics$Campaign)
unique(summary_table_cluster_analytics$`Billing Index`)
makeExcelRawData <- function(dt){
check <- dt[(dt$Impressions>0),] # & (as.Date(dt$Date)>'2018-08-28'),]
for(col in names(check)) set(check, i=which(grepl('^$|^NA$',check[[col]])),j=col,value='-')
for (i in names(check)){check[is.na(get(i)),(i):=0]}
check2 <- check[,c(3,4,5,26,27,28,29,30,31,32,33,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,100,103,104,105,110,111,112,113,114,115,116,117,109,119,1,124,125,126,2,146,147,148,149,152,153,154,127,128,129,130,132,133,134,135,136,137,138,139,140,141,142,143,144,131,156,157,158,159,160,161,162,163,164,165,166,167,169,170,171,172,173,174,175,176,177,178,179)]
write.csv(check2,'new_data.csv')
}
makeExcelRawData(summary_table_cluster_analytics)
makeExcelRawData <- function(dt){
check <- dt[(dt$Impressions>0),] # & (as.Date(dt$Date)>'2018-08-28'),]
for(col in names(check)) set(check, i=which(grepl('^$|^NA$',check[[col]])),j=col,value='-')
for (i in names(check)){check[is.na(get(i)),(i):=0]}
check2 <- check[,c(3,4,5,26,27,28,29,30,31,32,33,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,100,103,104,105,110,111,112,113,114,115,116,117,109,119,1,124,125,126,2,146,147,148,149,152,153,154,127,128,129,130,132,133,134,135,136,137,138,139,140,141,142,143,144,131,155,156,157,158,159,160,161,162,163,164,165,166,167,169,170,171,172,173,174,175,176,177,178)]
write.csv(check2,'new_data.csv')
}
makeExcelRawData(summary_table_cluster_analytics)
shiny::runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
cat("\014")
jsCode <- paste0("shinyjs.init = function(){(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-W6CQG8K');}")
shiny::runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
state_limits <- fread('data/state_limits.csv')
state_limits <- fread(/Users/harveymanhood/Documents/- github/Gale-DataScience/quva/visualisation/data/state_limits.csv')
state_limits <- fread('/Users/harveymanhood/Documents/- github/Gale-DataScience/quva/visualisation/data/state_limits.csv')
state_limits
state_limits[state_limits$State=='California',c('W')]
class(state_limits[state_limits$State=='California',c('W')])
class(unlist(state_limits[state_limits$State=='California',c('W')]))
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
unlist(state_limits[state_limits$State=='California',c('W')])
unlist(state_limits[state_limits$State=='California',1])
unlist(state_limits[state_limits$State=='California',2])
unlist(state_limits[state_limits$State=='California',2][1])
state_limits
state_limits[4,'S']
state_limits[4,S]
unlist(state_limits[state_limits$State=='California',W])
state_limits[state_limits$State=='California',W]
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
state_limits[state_limits$State==input$filterStates,W]
state_limits[state_limits$State=='California',W]
class(state_limits[state_limits$State==input$filterStates,W])
class(state_limits[state_limits$State=='California',W])
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
state_limits$State
state_limits[state_limits$State!='Whole Us',]$State
state_limits[state_limits$State!='Whole US',]$State
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
sample(seq(3), 1000, replace = T)
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
runApp('Documents/- github/Gale-DataScience/quva/visualisation')
shiny::runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
seq(1,5)
income_labs_count <- c(1,2,3,4)
income_labs_count
income_labs_count == seq(1,4)
income_labs_count == seq(1,income_labs.length-1)
income_labs_count == seq(1,length(income_labs)-1)
income_labs <- create_labs(c(0, 48.525, 80.564, 141.836, 176.893))
income_labs
length(income_labs)
seq(1,length(income_labs)-1)
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
paste('1','2','3',',')
all_labs <- c(income_labs,bed_labs,opclaimed_labs,ipcosts_labs,cmi_labs,avgstay_labs,households_labs,safety_labs,performance_labs)
all_labs
income_labs <- create_labs(c(0, 48.525, 80.564, 141.836, 176.893))
bed_labs <- create_labs(c(3, 50.0, 100, 150, 254.456, 1532.489, 2409.971, 2635.0, 4000.0))
opclaimed_labs <- create_labs(c(0, 1001, 5000, 9140.479, 35608.014, 44765.146, 58625.375))
ipcosts_labs <- create_labs(c(0, 164.197, 15070.302, 6021665.45, 313446375.0))
cmi_labs <- create_labs(c(0, 1.185, 1.897, 2.489, 2.921))
avgstay_labs <- create_labs(c(-0.474, 6.546, 10.75))
households_labs <- create_labs(c(0,5323.096, 15075.413, 20805.224, 21687.004, 23381.0))
safety_labs <- create_labs(c(0.0, 5.0, 10.0, 12.618, 14.957, 16.546, 20.0, 22.507, 128.8))
performance_labs <- create_labs(c(0, 29.828, 63.414, 82.273))
all_labs <- c(income_labs,bed_labs,opclaimed_labs,ipcosts_labs,cmi_labs,avgstay_labs,households_labs,safety_labs,performance_labs)
all_labs
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
all_labs
class(all_labs)
paste(all_labs,collapse=',')
runApp('Documents/- github/kuwa/quva_am/visualisation')
paste(all_labs,collapse=',')
all_labs <- c(income_labs,bed_labs,opclaimed_labs,ipcosts_labs,cmi_labs,avgstay_labs,households_labs,safety_labs,performance_labs)
jsCode <- paste0("shinyjs.init = function(){(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-W6CQG8K');dataLayer.push(",paste(all_labs,collapse=','),");}")
jsCode
all_labs <- paste0(c(income_labs,bed_labs,opclaimed_labs,ipcosts_labs,cmi_labs,avgstay_labs,households_labs,safety_labs,performance_labs),collapse="','")
all_labs
all_labs <- paste0("'",c(income_labs,bed_labs,opclaimed_labs,ipcosts_labs,cmi_labs,avgstay_labs,households_labs,safety_labs,performance_labs),"'",collapse="','")
all_labs
all_labs <- paste0(c("'",income_labs,bed_labs,opclaimed_labs,ipcosts_labs,cmi_labs,avgstay_labs,households_labs,safety_labs,performance_labs,"'"),collapse="','")
all_labs
all_labs <- paste0(c(income_labs,bed_labs,opclaimed_labs,ipcosts_labs,cmi_labs,avgstay_labs,households_labs,safety_labs,performance_labs),collapse="','")
all_labs
all_labs <- paste0(c("'",income_labs,bed_labs,opclaimed_labs,ipcosts_labs,cmi_labs,avgstay_labs,households_labs,safety_labs,performance_labs),collapse="','")
all_labs
all_labs <- paste0("'",paste0(c(income_labs,bed_labs,opclaimed_labs,ipcosts_labs,cmi_labs,avgstay_labs,households_labs,safety_labs,performance_labs),collapse="','"),"'")
all_labs
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
length(avgstay_labs)
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
all_labs <- paste0("'",c(income_labs,bed_labs,opclaimed_labs,ipcosts_labs,cmi_labs,avgstay_labs,households_labs,safety_labs,performance_labs),"'")
all_labs_counts <- paste0(c(length(income_labs),length(bed_labs),length(opclaimed_labs),length(ipcosts_labs),length(cmi_labs),length(avgstay_labs),length(households_labs),length(safety_labs),length(performance_labs)),collapse="','")
jsCode <- paste0("shinyjs.init = function(){(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-W6CQG8K');dataLayer.unshift({all_labs:[",all_labs,"],all_labs_counts:[",all_labs_counts,"]});}")
jsCode
all_labs_counts <- paste0(c(length(income_labs),length(bed_labs),length(opclaimed_labs),length(ipcosts_labs),length(cmi_labs),length(avgstay_labs),length(households_labs),length(safety_labs),length(performance_labs)),collapse="','")
all_labs_counts
all_labs <- paste0(c(income_labs,bed_labs,opclaimed_labs,ipcosts_labs,cmi_labs,avgstay_labs,households_labs,safety_labs,performance_labs),collapse="','")
all_labs
all_labs <- paste0("'",paste0(c(income_labs,bed_labs,opclaimed_labs,ipcosts_labs,cmi_labs,avgstay_labs,households_labs,safety_labs,performance_labs),collapse="','"),"'")
all_labs_counts <- paste0(c(length(income_labs),length(bed_labs),length(opclaimed_labs),length(ipcosts_labs),length(cmi_labs),length(avgstay_labs),length(households_labs),length(safety_labs),length(performance_labs)))
jsCode <- paste0("shinyjs.init = function(){(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-W6CQG8K');dataLayer.unshift({all_labs:[",all_labs,"],all_labs_counts:[",all_labs_counts,"]});}")
all_labs
all_labs_counts
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
shiny::runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa/quva_am/visualisation')
runApp('Documents/- github/kuwa-Y/quva_am/visualisation')
runApp('Documents/- github/kuwa-Y/quva_am/visualisation')
runApp('Documents/- github/kuwa-Y/quva_am/visualisation')
shiny::runApp('Documents/- github/kuwa/quva_am/visualisation')
